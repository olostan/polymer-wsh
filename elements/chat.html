<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="message.html">
<link rel="import" href="../bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/core-icons/core-icons.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">

<polymer-element name="my-chat">
    <template>
        <link rel="stylesheet" href="chat.css">
        <h1>Chat</h1>
        <div id="messages">
            <template repeat="{{ message in messages }}">
                <my-message  who="{{message.who}}" message="{{message.text}}"></my-message>
            </template>
        </div>
        <div id="input-bar">
            <core-toolbar>
                <div flex>
                    <paper-input id="input" label="Your message" value="{{message}}"
                                 on-keypress="{{keyPressed}}" ></paper-input>
                </div>
                <paper-fab icon="add"></paper-fab>
            </core-toolbar>
        </div>
        <core-ajax url="../messages.json" id="ajax"
                   handleAs="json"></core-ajax>
    </template>
    <script>

        Polymer({
            messages:[{who:'Bob', text:'Hello!'}],
            ready: function() {
                var ajax = this.$.ajax;
                var chat = this;
                ajax.addEventListener('core-response', function(e) {
                    chat.messages = this.response;
                });
                ajax.go(); // Call its API methods.
            },
            message:'',
            addMessage: function() {
                var input = this.$['input-bar'].querySelector('#input');
                this.messages.push({who:'Me', text:input.inputValue});
                input.inputValue = '';
            },
            keyPressed: function(e) {
                if (e.charCode==13) this.addMessage();
            }
        });
    </script>
</polymer-element>